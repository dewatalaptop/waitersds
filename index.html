<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Alokasi Peralatan Restoran</title>
  <style>
    body { font-family: sans-serif; }
    input, select, button { margin: 5px; padding: 5px; }
    .badge { padding: 3px 6px; border-radius: 4px; color: white; font-size: 0.8em; }
    .ds { background-color: green; }
    .sw { background-color: red; }
  </style>
</head>
<body>

<h2>Form Reservasi</h2>
<form id="form">
  Nama: <input type="text" id="nama"><br>
  Jam: <input type="time" id="jam"><br>
  Peserta: <input type="number" id="peserta"><br>
  Jumlah Lauk: <input type="number" id="lauk"><br>
  Menu: 
  <label><input type="checkbox" id="nasi"> Nasi</label>
  <label><input type="checkbox" id="sup"> Sup</label>
  <label><input type="checkbox" id="es"> Es</label>
  <label><input type="checkbox" id="teh"> Teh</label><br>
  <button type="submit">Cek Alokasi</button>
</form>

<h3>Hasil Alokasi:</h3>
<ul id="hasil"></ul>

<script>
const stok = {
  lauk: [
    { nama: "Roll top besar", kapasitas: 100, stok: 2 },
    { nama: "Roll top sedang", kapasitas: 60, stok: 4 },
    { nama: "Roll top kecil", kapasitas: 40, stok: 6 }
  ],
  nasi: [
    { nama: "Magicom besar", kapasitas: 50, stok: 2 },
    { nama: "Magicom kecil", kapasitas: 20, stok: 3 }
  ],
  sup: [
    { nama: "Pemanas sup besar", kapasitas: 40, stok: 2 },
    { nama: "Pemanas sup kecil", kapasitas: 20, stok: 3 }
  ],
  es: [
    { nama: "Tempat es besar", kapasitas: 100, stok: 5 }
  ],
  teh: [
    { nama: "Dispenser teh besar", kapasitas: 50, stok: 2 }
  ]
};

const reservasi = [];

const durasiReservasiMs = 3.5 * 60 * 60 * 1000;

document.getElementById("form").addEventListener("submit", function(e) {
  e.preventDefault();
  const nama = document.getElementById("nama").value;
  const jam = document.getElementById("jam").value;
  const peserta = parseInt(document.getElementById("peserta").value);
  const lauk = parseInt(document.getElementById("lauk").value);
  const menu = {
    nasi: document.getElementById("nasi").checked,
    sup: document.getElementById("sup").checked,
    es: document.getElementById("es").checked,
    teh: document.getElementById("teh").checked
  };

  const jamMs = waktuKeMs(jam);
  const stokAktif = JSON.parse(JSON.stringify(stok));

  for (let r of reservasi) {
    const rJamMs = waktuKeMs(r.jam);
    const jarak = Math.abs(jamMs - rJamMs);
    if (jarak < durasiReservasiMs) {
      kurangiStok(stokAktif, r.alat);
    }
  }

  const alat = hitungAlokasi(peserta, lauk, menu, stokAktif);
  reservasi.push({ nama, jam, alat });

  const hasil = document.getElementById("hasil");
  hasil.innerHTML = `<li><b>${nama}</b> - ${jam}<br>${alat.join("<br>")}</li>`;
});

function waktuKeMs(waktu) {
  const [jam, menit] = waktu.split(":").map(Number);
  return jam * 3600000 + menit * 60000;
}

function kurangiStok(stok, alatList) {
  for (let item of alatList) {
    let nama = item.replace(/ <span.*$/, "").replace(" Refill", "");
    for (let kategori in stok) {
      for (let alat of stok[kategori]) {
        if (alat.nama === nama && alat.stok > 0) {
          alat.stok--;
          break;
        }
      }
    }
  }
}

function hitungAlokasi(peserta, jumlahLauk, menu, stok) {
  const alokasi = [];
  let sisaLauk = jumlahLauk;

  // Urutkan prioritas kapasitas besar dulu
  const laukPrioritas = stok.lauk.sort((a, b) => b.kapasitas - a.kapasitas);

  for (let alat of laukPrioritas) {
    while (sisaLauk > 0 && peserta <= alat.kapasitas && alat.stok > 0) {
      let refill = peserta > 80 && alat.kapasitas >= 80 ? " Refill" : "";
      alokasi.push(`${alat.nama}${refill} <span class="badge ds">DS</span>`);
      alat.stok--;
      sisaLauk--;
    }
  }

  for (let alat of laukPrioritas) {
    while (sisaLauk > 0 && peserta <= alat.kapasitas) {
      let refill = peserta > 80 && alat.kapasitas >= 80 ? " Refill" : "";
      alokasi.push(`${alat.nama}${refill} <span class="badge sw">SW</span>`);
      sisaLauk--;
    }
  }

  if (menu.nasi) alokasi.push(cekAlat(peserta, stok.nasi, "magicom"));
  if (menu.sup) alokasi.push(cekAlat(peserta, stok.sup, "pemanas sup"));
  if (menu.es) alokasi.push(cekAlat(peserta, stok.es, "tempat es"));
  if (menu.teh) alokasi.push(cekAlat(peserta, stok.teh, "dispenser teh"));

  return alokasi;
}

function cekAlat(peserta, list, jenis) {
  for (let alat of list) {
    if (peserta <= alat.kapasitas && alat.stok > 0) {
      alat.stok--;
      return `${alat.nama} <span class="badge ds">DS</span>`;
    }
  }
  for (let alat of list) {
    if (peserta <= alat.kapasitas) {
      return `${alat.nama} <span class="badge sw">SW</span>`;
    }
  }
  return `${jenis} tidak tersedia`;
}
</script>

</body>
</html>